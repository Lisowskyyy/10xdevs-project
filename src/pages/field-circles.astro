---
import Layout from "../layouts/Layout.astro";
import { createServerSupabaseClient } from "../lib/supabase";

const supabase = createServerSupabaseClient(Astro.cookies);

// Pobierz WSZYSTKO jak leci
const { data: circles } = await supabase.from("field_circles").select("*").order("created_at", { ascending: false });
---

<Layout title="Diagnostyka KrÄ™gÃ³w">
  <div class="p-10 text-white">
    <h1 class="text-3xl mb-8">ğŸ” Wszystkie KrÄ™gi w Bazie ({circles?.length})</h1>

    <div class="grid gap-4">
      {
        circles?.map((c) => (
          <div class="border p-4 rounded bg-gray-800 flex justify-between items-center">
            <div>
              <h2 class="text-xl font-bold">{c.intention}</h2>
              <p class="text-gray-400">ID: {c.id}</p>
              <p class="text-yellow-400">
                Status w bazie: <strong>'{c.status}'</strong>
              </p>
              <p class="text-blue-300">Data Startu: {c.scheduled_at}</p>
            </div>
            <a href={`/circles/${c.id}`} class="bg-indigo-600 px-4 py-2 rounded">
              WejdÅº
            </a>
          </div>
        ))
      }
    </div>

    <a href="/circles/create" class="block mt-8 text-center bg-green-600 p-4 rounded">StwÃ³rz Nowy</a>
  </div>
</Layout>
